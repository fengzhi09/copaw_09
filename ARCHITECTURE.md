# CoPaw Architecture ğŸ—ï¸

> CoPaw ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£

---

## æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CoPaw Core                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Channels   â”‚    â”‚   Agents     â”‚    â”‚    Crons     â”‚      â”‚
â”‚  â”‚  (é’‰é’‰/é£ä¹¦)  â”‚    â”‚  (ReAct)     â”‚    â”‚  (å®šæ—¶ä»»åŠ¡)  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                   â”‚                   â”‚               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                             â”‚                                    â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                      â”‚   Router    â”‚                            â”‚
â”‚                      â”‚  (æ¶ˆæ¯è·¯ç”±)  â”‚                            â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                             â”‚                                    â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â”‚                   â”‚                   â”‚               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Skills    â”‚    â”‚   Memory    â”‚    â”‚   Tools     â”‚       â”‚
â”‚  â”‚  (èƒ½åŠ›)     â”‚    â”‚   (è®°å¿†)    â”‚    â”‚  (å·¥å…·)     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚    Model Provider      â”‚
                 â”‚ (OpenAI/Claude/...)    â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒæ¨¡å—

### 1. Channels (é¢‘é“å±‚)

è´Ÿè´£ä¸å„èŠå¤©å¹³å°çš„åŒå‘é€šä¿¡ï¼š

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| base | `app/channels/base.py` | é¢‘é“åŸºç±»ï¼Œå®šä¹‰æ¥å£ |
| dingtalk | `app/channels/dingtalk.py` | é’‰é’‰ WebHook/WebSocket |
| feishu | `app/channels/feishu.py` | é£ä¹¦ WebSocket/æ¶ˆæ¯å¡ç‰‡ |
| qq | `app/channels/qq.py` | QQ åè®®é€šä¿¡ |
| discord | `app/channels/discord_.py` | Discord Bot API |
| imessage | `app/channels/imessage.py` | macOS iMessage |
| console | `app/channels/console.py` | Web æ§åˆ¶å° |
| manager | `app/channels/manager.py` | é¢‘é“ç®¡ç† |

### 2. Agents (æ™ºèƒ½ä½“å±‚)

æ ¸å¿ƒæ¨ç†ä¸å†³ç­–ï¼š

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| react_agent | `agents/react_agent.py` | ReAct æ¨ç† Agent |
| skills_manager | `agents/skills_manager.py` | Skills åŠ è½½ä¸ç®¡ç† |
| prompt | `agents/prompt.py` | Prompt æ¨¡æ¿ |
| memory | `agents/memory/` | è®°å¿†ç³»ç»Ÿ |
| tools | `agents/tools/` | å·¥å…·æ³¨å†Œ |
| md_files | `agents/md_files/` | Markdown æ–‡ä»¶å¤„ç† |

### 3. Skills (èƒ½åŠ›å±‚)

å¯æ’æ‹”çš„èƒ½åŠ›æ¨¡å—ï¼š

```
skills/
â”œâ”€â”€ active_skills/      # å†…ç½® Skillsï¼ˆåªè¯»ï¼‰
â”‚   â”œâ”€â”€ pdf/
â”‚   â”œâ”€â”€ xlsx/
â”‚   â”œâ”€â”€ docx/
â”‚   â”œâ”€â”€ pptx/
â”‚   â”œâ”€â”€ file_reader/
â”‚   â”œâ”€â”€ browser_visible/
â”‚   â”œâ”€â”€ cron/
â”‚   â”œâ”€â”€ news/
â”‚   â”œâ”€â”€ himalaya/
â”‚   â””â”€â”€ ...
â””â”€â”€ ext_skills/         # ç”¨æˆ·æ‰©å±• Skills
    â”œâ”€â”€ feishu-doc/
    â”œâ”€â”€ feishu-wiki/
    â””â”€â”€ ...
```

### 4. Crons (å®šæ—¶ä»»åŠ¡)

è‡ªåŠ¨åŒ–ä»»åŠ¡è°ƒåº¦ï¼š

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| cron_manager | `app/crons/` | å®šæ—¶ä»»åŠ¡ç®¡ç† |
| heartbeat | `app/crons/heartbeat.py` | å¿ƒè·³/è‡ªæ£€ |

### 5. Console (Web æ§åˆ¶å°)

Browser-based ç®¡ç†ç•Œé¢ï¼š

```
console/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ pages/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ public/
â””â”€â”€ package.json
```

### 6. CLI (å‘½ä»¤è¡Œå·¥å…·)

ç”¨æˆ·äº¤äº’å…¥å£ï¼š

| å‘½ä»¤ | åŠŸèƒ½ |
|------|------|
| `copaw init` | åˆå§‹åŒ–å·¥ä½œç›®å½• |
| `copaw app` | å¯åŠ¨æœåŠ¡ |
| `copaw cron` | å®šæ—¶ä»»åŠ¡ç®¡ç† |
| `copaw clean` | æ¸…ç©ºå·¥ä½œç›®å½• |

---

## æ•°æ®æµ

### æ¶ˆæ¯æ¥æ”¶æµç¨‹

```
User (é’‰é’‰/é£ä¹¦/QQ/Discord)
    â”‚
    â–¼
Channel Webhook/WebSocket
    â”‚
    â–¼
Channel Handler
    â”‚
    â–¼
Router (æ¶ˆæ¯è·¯ç”±)
    â”‚
    â–¼
Agent (ReAct)
    â”‚
    â”œâ”€â”€â–¶ Skills Manager (åŠ è½½ Skills)
    â”‚
    â”œâ”€â”€â–¶ Tools (æ‰§è¡Œå·¥å…·)
    â”‚
    â””â”€â”€â–¶ Model Provider (LLM æ¨ç†)
    â”‚
    â–¼
Response
    â”‚
    â–¼
Channel Handler
    â”‚
    â–¼
User
```

### å®šæ—¶ä»»åŠ¡æµç¨‹

```
Cron Scheduler
    â”‚
    â–¼
Cron Job (å¿ƒè·³/å®šæ—¶ä»»åŠ¡)
    â”‚
    â–¼
Agent (ReAct)
    â”‚
    â–¼
(åŒæ¶ˆæ¯å¤„ç†æµç¨‹)
    â”‚
    â–¼
Response â†’ æŒ‡å®š Channel
```

---

## é…ç½®æ–‡ä»¶

```
config/
â””â”€â”€ config.json          # ä¸»é…ç½®æ–‡ä»¶

å·¥ä½œç›®å½•/
â”œâ”€â”€ config.json          # ç”¨æˆ·é…ç½®
â”œâ”€â”€ memory/              # è®°å¿†å­˜å‚¨
â”œâ”€â”€ skills/              # Skills
â””â”€â”€ data/                # æ•°æ®æ–‡ä»¶
```

---

## æ‰©å±•ç‚¹

### æ·»åŠ æ–° Channel

1. ç»§æ‰¿ `Channel` åŸºç±»
2. å®ç° `start()`, `stop()`, `send()`, `handle_message()`
3. åœ¨ `channels/manager.py` æ³¨å†Œ

### æ·»åŠ æ–° Skill

1. åœ¨ `ext_skills/` åˆ›å»ºç›®å½•
2. æ·»åŠ  `SKILL.md`ï¼ˆè¯´æ˜æ–‡æ¡£ï¼‰
3. æ·»åŠ  `_meta.json`ï¼ˆå…ƒæ•°æ®ï¼‰
4. æ·»åŠ æ‰§è¡Œè„šæœ¬ï¼ˆPython/JSï¼‰

### æ·»åŠ æ–° Tool

1. åœ¨ `agents/tools/` æ·»åŠ å®ç°
2. æ³¨å†Œåˆ° Tools Manager
3. åœ¨ Skill ä¸­å£°æ˜ä¾èµ–

---

## æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ |
|------|------|
| æ ¸å¿ƒæ¡†æ¶ | Python 3.10+ |
| Agent å¼•æ“ | AgentScope |
| LLM è¿è¡Œæ—¶ | AgentScope Runtime |
| è®°å¿†ç³»ç»Ÿ | ReMe |
| Web æ¡†æ¶ | Flask / aiohttp |
| å‰ç«¯ | React + TypeScript |
| æ¨¡å‹è°ƒç”¨ | OpenAI API å…¼å®¹ |

---

## éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Production                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   nginx     â”‚â”€â”€â”€â–¶â”‚   CoPaw     â”‚â”€â”€â”€â–¶â”‚   Model     â”‚   â”‚
â”‚   â”‚  (åå‘ä»£ç†)  â”‚    â”‚   (æœåŠ¡)    â”‚    â”‚   Provider  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                  â”‚                                 â”‚
â”‚         â”‚            â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                            â”‚
â”‚         â”‚            â”‚  SQLite â”‚                            â”‚
â”‚         â”‚            â”‚  (æ•°æ®)  â”‚                            â”‚
â”‚         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚         â”‚                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                                             â”‚
â”‚   â”‚  Channel  â”‚  é’‰é’‰/é£ä¹¦/QQ/Discord                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®‰å…¨è€ƒè™‘

- æ‰€æœ‰æ•°æ®æœ¬åœ°å­˜å‚¨
- æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
- Channel è®¤è¯ Token å®‰å…¨ç®¡ç†
- æ²™ç›’æ‰§è¡Œç”¨æˆ·ä»£ç 

---

## æ€§èƒ½ä¼˜åŒ–

- Skills æ‡’åŠ è½½
- å‘é‡è®°å¿†ç¼“å­˜
- å¹¶å‘ä»»åŠ¡è°ƒåº¦
- æ¨¡å‹å“åº”æµå¼è¾“å‡º
