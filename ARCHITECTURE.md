# CoPaw Architecture ğŸ—ï¸

> CoPaw ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£

---

## æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CoPaw Core (v0.0.2)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Channels   â”‚    â”‚    Crons     â”‚    â”‚   Console    â”‚     â”‚
â”‚  â”‚  (6 channels)â”‚    â”‚  (å®šæ—¶ä»»åŠ¡)  â”‚    â”‚  (Web UI)   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                    â”‚                    â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                              â”‚                                   â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                      â”‚    Runner     â”‚                          â”‚
â”‚                      â”‚ (AgentRunner) â”‚                          â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                              â”‚                                   â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚         â”‚                    â”‚                    â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Skills    â”‚    â”‚    Memory     â”‚    â”‚   Tools     â”‚   â”‚
â”‚  â”‚  (9 built-in)â”‚   â”‚   (è®°å¿†)     â”‚    â”‚  (Agent)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚                              â”‚                                   â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                      â”‚    Agent      â”‚                          â”‚
â”‚                      â”‚  (CoPawAgent) â”‚                          â”‚
â”‚                      â”‚   (ReAct)     â”‚                          â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                 â”‚   Model Providers      â”‚                      â”‚
â”‚                 â”‚ (DashScope/è‡ªå®šä¹‰)    â”‚                      â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚   FastAPI Server      â”‚
                 â”‚    (AgentScope Runtime)â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒæ¨¡å—

### 1. CLI (`cli/`)

å‘½ä»¤è¡Œå·¥å…·å…¥å£ï¼š

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `main.py` | CLI å…¥å£ï¼Œä½¿ç”¨ Click |
| `app_cmd.py` | å¯åŠ¨åº”ç”¨æœåŠ¡ |
| `init_cmd.py` | åˆå§‹åŒ–å·¥ä½œç›®å½• |
| `channels_cmd.py` | é¢‘é“ç®¡ç† |
| `cron_cmd.py` | å®šæ—¶ä»»åŠ¡ç®¡ç† |
| `skills_cmd.py` | Skills ç®¡ç† |
| `env_cmd.py` | ç¯å¢ƒå˜é‡ç®¡ç† |
| `providers_cmd.py` | æ¨¡å‹æä¾›å•†ç®¡ç† |

### 2. App (`app/`)

åº”ç”¨ä¸»ç¨‹åºï¼ŒåŸºäº FastAPI + AgentScope Runtimeï¼š

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| _app.py | `_app.py` | FastAPI åº”ç”¨å…¥å£ï¼Œåˆ›å»º AgentApp |
| channels | `channels/` | é¢‘é“å®ç° |
| crons | `crons/` | å®šæ—¶ä»»åŠ¡ |
| runner | `runner/` | AgentRunner è¿è¡Œå™¨ |
| routers | `routers/` | API è·¯ç”± |

#### Channels (`app/channels/`)

| æ–‡ä»¶ | é¢‘é“ |
|------|------|
| `feishu.py` | é£ä¹¦ |
| `dingtalk.py` | é’‰é’‰ |
| `qq.py` | QQ |
| `discord_.py` | Discord |
| `imessage.py` | iMessage (Mac) |
| `console.py` | Web Console |
| `base.py` | é¢‘é“åŸºç±» |
| `manager.py` | é¢‘é“ç®¡ç†å™¨ |

#### Crons (`app/crons/`)

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `manager.py` | Cron ç®¡ç†å™¨ |
| `executor.py` | ä»»åŠ¡æ‰§è¡Œå™¨ |
| `heartbeat.py` | å¿ƒè·³/è‡ªæ£€ |
| `api.py` | Cron API |

### 3. Agents (`agents/`)

Agent æ ¸å¿ƒå®ç°ï¼š

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `react_agent.py` | CoPawAgent (ReAct æ¨ç†) |
| `skills_manager.py` | Skills åŠ è½½ä¸ç®¡ç† |
| `prompt.py` | Prompt æ¨¡æ¿ |
| `schema.py` | æ•°æ®ç»“æ„å®šä¹‰ |
| `utils.py` | å·¥å…·å‡½æ•° |

#### Skills (`agents/skills/`)

å†…ç½® Skills (9ä¸ª)ï¼š

```
skills/
â”œâ”€â”€ pdf/           # PDF å¤„ç†
â”œâ”€â”€ xlsx/          # Excel å¤„ç†
â”œâ”€â”€ docx/          # Word å¤„ç†
â”œâ”€â”€ pptx/          # PPT å¤„ç†
â”œâ”€â”€ news/          # æ–°é—»èµ„è®¯
â”œâ”€â”€ himalaya/      # é‚®ä»¶ç®¡ç†
â”œâ”€â”€ cron/          # å®šæ—¶ä»»åŠ¡
â”œâ”€â”€ browser_visible/ # å¯è§æµè§ˆå™¨
â””â”€â”€ file_reader/  # æ–‡ä»¶é˜…è¯»
```

#### Tools (`agents/tools/`)

Agent å·¥å…·é›†ï¼š

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `file_io.py` | æ–‡ä»¶è¯»å†™ |
| `shell.py` | æ‰§è¡Œå‘½ä»¤ |
| `browser_control.py` | æµè§ˆå™¨æ§åˆ¶ |
| `browser_snapshot.py` | æµè§ˆå™¨æˆªå›¾ |
| `memory_search.py` | è®°å¿†æœç´¢ |
| `desktop_screenshot.py` | æ¡Œé¢æˆªå›¾ |
| `send_file.py` | å‘é€æ–‡ä»¶ |
| `get_current_time.py` | è·å–æ—¶é—´ |

#### Memory (`agents/memory/`)

è®°å¿†ç³»ç»Ÿå®ç°

#### Md_files (`agents/md_files/`)

Markdown æ–‡ä»¶å¤„ç†

### 4. Config (`config/`)

é…ç½®ç®¡ç†ï¼š

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `config.py` | é…ç½®åŠ è½½ |
| `utils.py` | é…ç½®å·¥å…· |
| `watcher.py` | é…ç½®ç›‘è§† |

### 5. Providers (`providers/`)

æ¨¡å‹æä¾›å•†ï¼š

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `registry.py` | æä¾›å•†æ³¨å†Œè¡¨ |
| `store.py` | é…ç½®å­˜å‚¨ |
| `models.py` | æ•°æ®æ¨¡å‹ |

### 6. Envs (`envs/`)

ç¯å¢ƒå˜é‡åŠ è½½ï¼š

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `store.py` | ç¯å¢ƒå˜é‡å­˜å‚¨ |

---

## æ•°æ®æµ

### æ¶ˆæ¯æ¥æ”¶æµç¨‹

```
User (é’‰é’‰/é£ä¹¦/QQ/Discord/iMessage)
    â”‚
    â–¼
Channel Webhook/WebSocket
    â”‚
    â–¼
Channel Handler (channels/*.py)
    â”‚
    â–¼
AgentRunner (app/runner/)
    â”‚
    â–¼
CoPawAgent (agents/react_agent.py)
    â”‚
    â”œâ”€â”€â–¶ Skills Manager (åŠ è½½ Skills)
    â”‚
    â”œâ”€â”€â–¶ Tools (æ‰§è¡Œå·¥å…·)
    â”‚
    â””â”€â”€â–¶ Model Provider (LLM æ¨ç†)
    â”‚
    â–¼
Response
    â”‚
    â–¼
Channel Handler
    â”‚
    â–¼
User
```

### å®šæ—¶ä»»åŠ¡æµç¨‹

```
Cron Manager (app/crons/)
    â”‚
    â–¼
Cron Executor
    â”‚
    â–¼
AgentRunner â†’ CoPawAgent
    â”‚
    â–¼
(åŒæ¶ˆæ¯å¤„ç†æµç¨‹)
    â”‚
    â–¼
Response â†’ æŒ‡å®š Channel
```

---

## é…ç½®æ–‡ä»¶

### å·¥ä½œç›®å½•ç»“æ„

```
~/.copaw/                    # é»˜è®¤å·¥ä½œç›®å½•
â”œâ”€â”€ config.json              # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ jobs.json                # å®šæ—¶ä»»åŠ¡
â”œâ”€â”€ chats.json               # å¯¹è¯å†å²
â”œâ”€â”€ memory/                  # è®°å¿†å­˜å‚¨
â”œâ”€â”€ active_skills/           # å¯ç”¨çš„ Skills
â”œâ”€â”€ customized_skills/        # è‡ªå®šä¹‰ Skills
â”œâ”€â”€ media/                   # åª’ä½“æ–‡ä»¶
â””â”€â”€ logs/                   # æ—¥å¿—
```

### config.json ç»“æ„

```json
{
  "channels": {
    "feishu": {
      "enabled": true,
      "app_id": "...",
      "app_secret": "..."
    }
  },
  "agents": {
    "defaults": {
      "heartbeat": {...}
    }
  }
}
```

---

## æ‰©å±•ç‚¹

### æ·»åŠ æ–° Channel

1. ç»§æ‰¿ `Channel` åŸºç±» (`app/channels/base.py`)
2. å®ç° `start()`, `stop()`, `send()`, `handle_message()`
3. åœ¨ `app/channels/manager.py` æ³¨å†Œ

### æ·»åŠ æ–° Skill

1. åœ¨ `agents/skills/` åˆ›å»ºç›®å½•
2. æ·»åŠ  `SKILL.md`ï¼ˆè¯´æ˜æ–‡æ¡£ï¼‰
3. å®ç°æŠ€èƒ½é€»è¾‘

### æ·»åŠ æ–° Tool

1. åœ¨ `agents/tools/` æ·»åŠ å®ç°
2. æ³¨å†Œåˆ° Tools Manager

---

## æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ |
|------|------|
| æ ¸å¿ƒæ¡†æ¶ | Python 3.10+ |
| Agent å¼•æ“ | AgentScope Runtime |
| Web æ¡†æ¶ | FastAPI |
| CLI | Click |
| æ¨¡å‹è°ƒç”¨ | DashScope API |

---

## ç‰ˆæœ¬ä¿¡æ¯

- **å½“å‰ç‰ˆæœ¬**: 0.0.2
- **æºç æå–**: ä» PyPI copaw v0.0.2 site-packages
- **æ„å»ºåŸºç¡€**: AgentScope, AgentScope Runtime, ReMe

---

## å®‰å…¨è€ƒè™‘

- æ‰€æœ‰æ•°æ®æœ¬åœ°å­˜å‚¨
- æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†
- Channel è®¤è¯ Token å®‰å…¨ç®¡ç†

---

## æ€§èƒ½ä¼˜åŒ–

- Skills æ‡’åŠ è½½
- å¹¶å‘ä»»åŠ¡è°ƒåº¦
- æ¨¡å‹å“åº”æµå¼è¾“å‡º
